<div>
  <p *ngIf="isHourly"><em>Hourly data is shown in your local timezone</em></p>

  <div class="table-navigation">
    <button (click)="toggleExpandedReport.emit()" class="btn-link">
      <p *ngIf="!expanded">Show {{routerParams?.interval?.key}} numbers &#187;</p>
      <p *ngIf="expanded">Hide {{routerParams?.interval?.key}} numbers &#171;</p>
    </button>

    <metrics-episode-page
      [currentPage]="routerParams?.episodePage"
      [totalPages]="totalPages"
      (pageChange)="pageChange.emit($event)">
    </metrics-episode-page>
  </div>

  <div class="table-wrapper">
    <div class="sticky">
      <div class="header row">
        <div>Episode</div>
        <div>Release Date</div>
        <div class="charted">Downloads</div>
        <div>All-Time</div>
      </div>

      <div class="row" *ngIf="podcastTableData">
        <div>
          <prx-checkbox *ngIf="showPodcastToggle; else podcastTitle"
            small [checked]="podcastTableData.charted" [color]="podcastTableData.color"
            (change)="toggleChartPodcast.emit({id: routerParams.podcastId, charted: $event})">
            {{podcastTableData.title}}
          </prx-checkbox>
          <ng-template #podcastTitle><span class="title">{{podcastTableData.title}}</span></ng-template>
        </div>
        <div></div>
        <div class="charted">{{podcastTableData.totalForPeriod | largeNumber}}</div>
        <div *ngIf="podcastTableData.allTimeDownloads !== undefined">{{podcastTableData.allTimeDownloads | largeNumber}}</div>
        <div *ngIf="podcastTableData.allTimeDownloads === undefined"></div>
      </div>

      <div class="row" *ngFor="let episode of episodeTableData">
        <div>
          <prx-checkbox *ngIf="showEpisodeToggles; else episodeTitle"
            small [checked]="episode.charted" [color]="episode.color"
                        (change)="toggleChartEpisode.emit({guid: episode.id, charted: $event})"><span [title]="episode.title">{{episode.title}}</span></prx-checkbox>
          <ng-template #episodeTitle>
            <button class="btn-link title" (click)="chartSingleEpisode.emit(episode.id)" [title]="episode.title">{{episode.title}}</button>
          </ng-template>
        </div>
        <div>{{releaseDateFormat(episode.publishedAt)}}</div>
        <div class="charted">{{episode.totalForPeriod | largeNumber}}</div>
        <div *ngIf="episode.allTimeDownloads !== undefined">{{episode.allTimeDownloads | largeNumber}}</div>
        <div *ngIf="episode.allTimeDownloads === undefined"></div>
      </div>
    </div>
    
    <metrics-scrolling-table
      *ngIf="expanded"
      [headings]="dateRange"
      [tableData]="intervalData">
    </metrics-scrolling-table>

  </div>
</div>
